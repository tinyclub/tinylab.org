---
layout: weekly
author: '呀呀呀'
title: 'RISC-V Linux 内核及周边技术动态第 101 期'
draft: false
group: 'news'
album: 'RISC-V Linux'
license: 'cc-by-nc-nd-4.0'
permalink: /rvlwn-101/
description: 'RISC-V Linux 内核及周边技术动态第 101 期'
category:
  - 开源项目
  - RISC-V
tags:
  - Linux
  - RISC-V
  - StarFive
  - purgatory
  - xtheadvecotr
  - spacemit
  - Sophgo 
---

> 时间：20240721<br/>
> 编辑：晓瑜<br/>
> 仓库：[RISC-V Linux 内核技术调研活动](https://gitee.com/tinylab/riscv-linux)<br/>
> 赞助：PLCT Lab, ISCAS

## 内核动态

### RISC-V 架构支持

**[GIT PULL: RISC-V Patches for the 6.11 Merge Window, Part 1](http://lore.kernel.org/linux-riscv/mhng-099fa737-a1fc-466d-bf27-9ad62173bb45@palmer-ri-x1c9/)**

> Got the fixed stacked up locally until things get
> sorted out.  Aside from that everything looks clean on my end.

**[v1: cache: StarFive: Require a 64-bit system](http://lore.kernel.org/linux-riscv/20240719163841.19018-1-palmer@rivosinc.com/)**

> This has a bunch of {read,write}q() calls, so it won't work on 32-bit
> systems.

**[v3: riscv/purgatory: align riscv_kernel_entry](http://lore.kernel.org/linux-riscv/20240719170437.247457-1-cyrevolt@gmail.com/)**

> This has been tested on a JH7110 SoC with oreboot and its SBI delegating
> unaligned access exceptions and the kernel configured to handle them.

**[v5: riscv: Add support for xtheadvector](http://lore.kernel.org/linux-riscv/20240719-xtheadvector-v5-0-4b485fc7d55f@rivosinc.com/)**

>  All of the vector routines have been modified to
> support this alternative vector version based upon whether xtheadvector
> was determined to be supported at boot.

**[v3: riscv: Separate vendor extensions from standard extensions](http://lore.kernel.org/linux-riscv/20240719-support_vendor_extensions-v3-0-0af7587bbec0@rivosinc.com/)**

> All extensions, both standard and vendor, live in one struct
> "riscv_isa_ext".

**[v1: riscv: spacemit: add pinctrl support to K1 SoC](http://lore.kernel.org/linux-riscv/20240719-02-k1-pinctrl-v1-0-239ac5b77dd6@gentoo.org/)**

> This series adds pinctrl support to SpacemiT's K1 SoC which
> has feature compatible with pinctrl-single driver, then later
> add pinctrl property for Bananapi-F3 uart device.

**[v5: mmc: sdhci-of-dwcmshc: Add Sophgo SG2042 support](http://lore.kernel.org/linux-riscv/cover.1721377374.git.unicorn_wang@outlook.com/)**

> The reason for merging the two parts into one patchset is mainly to
> facilitate review, especially to facilitate viewing why we need to
> improve the framework and what benefits it will bring to us.

**[v1: RISC-V: Implement kgdb_roundup_cpus() to enable IPI KGDB Roundup](http://lore.kernel.org/linux-riscv/20240719081210.1457512-1-ruanjinjie@huawei.com/)**

>  A custom one allows to debug CPUs that are stuck with interrupts
> disabled.

**[v1: Add perf support to collect KVM guest statistics from host side](http://lore.kernel.org/linux-riscv/cover.1721271251.git.zhouquan@iscas.ac.cn/)**

> Add basic guest support to RISC-V perf, enabling it to distinguish
> whether PMU interrupts occur in the host or the guest, and then
> collect some basic guest information from the host side
> (guest os callchain is not supported for now).

**[v2: RISC-V: Enable IPI CPU Backtrace](http://lore.kernel.org/linux-riscv/20240718093659.158912-1-takakura@valinux.co.jp/)**

> Add arch_trigger_cpumask_backtrace() which is a generic infrastructure
> for sampling other CPUs' backtrace using IPI.

**[v1: riscv/mm/fault: add show_pte() before die()](http://lore.kernel.org/linux-riscv/20240718020935.12803-1-cuiyunhui@bytedance.com/)**

> When the kernel displays "Unable to handle kernel paging request at
> virtual address", we would like to confirm the status of the virtual
> address in the page table. So add show_pte() before die().

**[v3: riscv: Per-thread envcfg CSR support](http://lore.kernel.org/linux-riscv/20240718004808.2246354-1-samuel.holland@sifive.com/)**

> This series (or equivalent) is a prerequisite for both user-mode pointer
> masking and CFI support, as both of those are per-thread features and
> are controlled by fields in the envcfg CSR.

**[v1: mm: THP-agnostic refactor on huge mappings](http://lore.kernel.org/linux-riscv/20240717220219.3743374-1-peterx@redhat.com/)**

> This is an RFC series, so not yet for merging.

**[v5: RISC-V: Detect and report speed of unaligned vector accesses](http://lore.kernel.org/linux-riscv/20240717180727.4180475-1-jesse@rivosinc.com/)**

> Adds support for detecting and reporting the speed of unaligned vector
> accesses on RISC-V CPUs.

**[v1: riscv: Allow to build only with LLVM >= 17.0.0](http://lore.kernel.org/linux-riscv/20240717111716.157149-1-alexghiti@rivosinc.com/)**

> This is a known issue [1] so let's upgrade the minimal requirement for
> LLVM to the version 17.0.0, which is the first version to contain the
> fix.

**[v1: RISC-V: hwprobe: sort EXT_KEY()s in hwprobe_isa_ext0() alphabetically](http://lore.kernel.org/linux-riscv/20240717-dedicate-squeamish-7e4ab54df58f@spud/)**

> Currently the entries appear to be in a random order (although according
> to Palmer he has tried to sort them by key value) which makes it harder
> to find entries in a growing list, and more likely to have conflicts as
> all patches are adding to the end of the list. Sort them alphabetically
> instead.

**[v2: riscv: add tracepoints for page fault](http://lore.kernel.org/linux-riscv/20240717082728.84401-1-zhuhengbo@iscas.ac.cn/)**

> Introduce page_fault_user and page_fault_kernel for riscv page fault.
> Help to get more detail information when page fault happen.

**[v3: Zacas/Zabha support and qspinlocks](http://lore.kernel.org/linux-riscv/20240717061957.140712-1-alexghiti@rivosinc.com/)**

> This implements [cmp]xchgXX() macros using Zacas and Zabha extensions
> and finally uses those newly introduced macros to add support for
> qspinlocks: note that this implementation of qspinlocks satisfies the
> forward progress guarantee.

**[v2: RISC-V: Enable the IPI before workqueue_online_cpu()](http://lore.kernel.org/linux-riscv/20240717031714.1946036-1-nick.hu@sifive.com/)**

> Sometimes the hotplug cpu stalls at the arch_cpu_idle() for a while after
> workqueue_online_cpu().

**[v1: mm: introduce numa_memblks](http://lore.kernel.org/linux-riscv/20240716111346.3676969-1-rppt@kernel.org/)**

> Following the discussion about handling of CXL fixed memory windows on
> arm64 [1] I decided to bite the bullet and move numa_memblks from x86 to
> the generic code so they will be available on arm64/riscv and maybe on
> loongarch sometime later.

**[v4: riscv: sophgo: add thermal sensor support for cv180x/sg200x SoCs](http://lore.kernel.org/linux-riscv/SEYPR01MB422158B2766DA03728AD90CBD7A22@SEYPR01MB4221.apcprd01.prod.exchangelabs.com/)**

> This series implements driver for Sophgo cv180x/sg200x on-chip thermal
> sensor and adds thermal zones for CV1800B SoCs.

**[v2: riscv: sophgo: add mailbox support for cv18x SoCs](http://lore.kernel.org/linux-riscv/SYBP282MB223825D5903777B937A8A377C4A02@SYBP282MB2238.AUSP282.PROD.OUTLOOK.COM/)**

> Add mailbox support for Sophgo cv18x SoCs, and test on both cv1800b SoC for
> milkv-duo and cv1812h SoC for milkv-duo256m

**[v1: net-next: Add the dwmac driver support for T-HEAD TH1520 SoC.](http://lore.kernel.org/linux-riscv/20240713-thead-dwmac-v1-0-81f04480cd31@tenstorrent.com/)**

> Marking this as an RFC since it has been almost a year since the
> previous series and Jisheng has handed it off to me.

### LoongArch 架构支持

**[v3: LoongArch: CPU parallel bring up](http://lore.kernel.org/loongarch/20240716-loongarch-hotplug-v3-0-af59b3bb35c8@flygoat.com/)**

> This series implemented CPU parallel bring up for LoongArch.

**[v1: LoongArch: KVM: Implement function kvm_arch_para_features](http://lore.kernel.org/loongarch/20240716125831.1621975-1-maobibo@loongson.cn/)**

> Function kvm_arch_para_features() is to detect supported para features,
> it can be used by device driver to detect and enable para features,
> such as extioi irqchip driver to detect KVM_FEATURE_VIRT_EXTIOI.

**[v5: LoongArch: Add AVEC irqchip support](http://lore.kernel.org/loongarch/20240715033440.26506-1-zhangtianyang@loongson.cn/)**

> Introduce the advanced extended interrupt controllers.

### ARM 架构支持

**[v3: phy: mvebu-cp110-utmi: add support for armada-380 utmi phys](http://lore.kernel.org/linux-arm-kernel/20240720-a38x-utmi-phy-v3-0-4c16f9abdbdc@solid-run.com/)**

> Add support for Armada 380 to cp110 utmi phy driver, and enable it for
> armada-388-clearfog boards.

**[v1: perf scripts python arm-cs-trace-disasm.py: Skip disasm if address continuity is broken](http://lore.kernel.org/linux-arm-kernel/20240719092619.274730-1-gankulkarni@os.amperecomputing.com/)**

> To generate the instruction tracing, script uses 2 contiguous packets
> address range.

**[v1: UEFI emulator for kexec](http://lore.kernel.org/linux-arm-kernel/20240718085759.13247-1-piliu@redhat.com/)**

> As more PE format kernel images are introduced, it post challenge to kexec to
> cope with the new format.

**[v3: Add support for Firefly Core-PX30-JD4 SoM & baseboard](http://lore.kernel.org/linux-arm-kernel/20240718-rockchip-px30-firefly-v3-0-3835cdd22eae@collabora.com/)**

> This adds support for the PX30-based Core-PX30-JD4 system-on-module from
> Firefly and includes support for the SoM in combination with the
> Firefly MB-JD4-PX30 baseboard.

**[v6: firmware: support i.MX95 SCMI BBM/MISC Extenstion](http://lore.kernel.org/linux-arm-kernel/20240718-imx95-bbm-misc-v2-v6-0-18f008e16e9d@nxp.com/)**

> This patchset is to support the two protocols and users that use the
> protocols.

**[v6: Constify tool pointers](http://lore.kernel.org/linux-arm-kernel/20240718010023.1495687-1-irogers@google.com/)**

> This change refactors struct perf_tool to have an init function that
> provides the default implementation. The special use of NULL and
> perf_tools__fill_defaults are removed.

**[v6: io-pgtable-arm + drm/msm: Extend iova fault debugging](http://lore.kernel.org/linux-arm-kernel/20240717163627.43423-1-robdclark@gmail.com/)**

> This series extends io-pgtable-arm with a method to retrieve the page
> table entries traversed in the process of address translation, and then
> beefs up drm/msm gpu devcore dump to include this (and additional info)
> in the devcore dump.

**[v2: rtc: stm32: add pinctrl interface to handle RTC outs](http://lore.kernel.org/linux-arm-kernel/20240717074835.2210411-1-valentin.caron@foss.st.com/)**

> This series adds a pinctrl/pinmux interface to control STM32 RTC outputs.

**[v1: dmaengine: stm32-dma3: Set lli_size after allocation](http://lore.kernel.org/linux-arm-kernel/20240716213830.work.951-kees@kernel.org/)**

> This requirement is not met in
> stm32_dma3_chan_desc_alloc(), since "lli_size" starts at "0", so "lli"
> index "0" will not be considered valid during the initialization for loop.


### X86 架构支持

**[v18: TPEBS counting mode support](http://lore.kernel.org/lkml/20240720062102.444578-1-weilin.wang@intel.com/)**

**[v1: platform/x86:dell-laptop: Add knobs to change battery charge settings](http://lore.kernel.org/lkml/20240720012220.26d62a54@5400/)**

> The Dell BIOS allows you to set custom charging modes, which is useful
> in particular for extending battery life. This adds support for tweaking
> those various settings from Linux via sysfs knobs.

**[GIT PULL: KVM changes for 6.11 merge window](http://lore.kernel.org/lkml/20240719145339.55027-1-pbonzini@redhat.com/)**

> The following changes since commit 256abd8e550ce977b728be79a74e1729438b4948:

**[v4: HP: wmi: added support for 4 zone keyboard rgb](http://lore.kernel.org/lkml/20240719100011.16656-1-carlosmiguelferreira.2003@gmail.com/)**

> This driver now supports brightness control and an initial version of mode
> control (all brightness values to 0 means off and otherwise its on).

**[v4: TDX MMU prep series part 1](http://lore.kernel.org/lkml/20240718211230.1492011-1-rick.p.edgecombe@intel.com/)**

> This is v4 of the TDX MMU prep series, split out of the giant 130 patch
> TDX base enabling series [0].

**[v1: x86/amd_nb: Add new PCI IDs for AMD family 0x1a model 60h](http://lore.kernel.org/lkml/20240718140258.3425851-1-Shyam-sundar.S-k@amd.com/)**

> Add the new PCI Device IDs to the root IDs and misc ids list to support
> new generation of AMD 1Ah family 60h Models of processors.

**[v1: tools/x86/kcpuid: Complete the CPUID database](http://lore.kernel.org/lkml/20240718134755.378115-1-darwi@linutronix.de/)**

> This patch series enhances the Linux Kernel's kcpuid tool with full
> cpuid leaves bitfields coverage through a CSV file generated from

**[v2: platform/x86: ideapad-laptop: synchronize VPC commands](http://lore.kernel.org/lkml/cover.1721258854.git.soyer@irl.hu/)**

> This series introduces a notification chain to receive YMC or other
> events, moves the EC triggering into ideapad-laptop, and then introduces
> a mutex to eliminate the problem.

**[git pull: drm next for 6.11-rc1](http://lore.kernel.org/lkml/CAPM=9tzsihck03q+ooJQhTdJsuT3eQ96zF6gd5cjDwLFu_zJhA@mail.gmail.com/)**

> This is the main drm next pull for 6.11. It has one minor conflict
> when I test merged it with your tree.

**[v1: Add support for Congatec CGEB BIOS interface](http://lore.kernel.org/lkml/20240718011504.4106163-1-mstrodl@csh.rit.edu/)**

> The following series adds support for the Congatec CGEB interface
> found on some Congatec x86 boards.

**[v1: 4.19: 4.19.318-rc3 review](http://lore.kernel.org/lkml/20240717101028.579732070@linuxfoundation.org/)**

> This is the start of the stable review cycle for the 4.19.318 release.

**[v1: Do not clear BSS region in x86 stub](http://lore.kernel.org/lkml/DS7PR19MB570996A580C6F5D2C9CACCE48BA32@DS7PR19MB5709.namprd19.prod.outlook.com/)**

> Clearing the BSS region may cause the UEFI firmware to malfunction
> during boot.

**[GIT PULL: perf-tools for v6.11](http://lore.kernel.org/lkml/20240717010342.900344-1-namhyung@kernel.org/)**

> Please consider pulling the following changes in perf tools for v6.11.

**[GIT PULL: ftrace: Rewrite of function graph to allow multiple users](http://lore.kernel.org/lkml/20240716162714.48febeaf@rorschach.local.home/)**

> Up until now, the function graph tracer could only have a single user
> attached to it. If another user tried to attach to the function graph
> tracer while one was already attached, it would fail.

**[v2: PCI: Align small (<4k) BARs](http://lore.kernel.org/lkml/20240716193246.1909697-1-stewart.hildebrand@amd.com/)**

> This series sets the default minimum resource alignment to 4k for memory
> BARs.

**[v2: hwmon: add GPD devices sensor driver](http://lore.kernel.org/lkml/20240717-gpd_fan-v2-0-f7b7e6b9f21b@gmail.com/)**

> Sensors driver for GPD Handhelds that expose fan reading and control via
> hwmon sysfs.

**[GIT PULL: Performance events changes for v6.11](http://lore.kernel.org/lkml/ZpaRBAgN9QLHJ8NZ@gmail.com/)**

**[GIT PULL: Networking for v6.11](http://lore.kernel.org/lkml/20240716152031.1288409-1-kuba@kernel.org/)**

**[GIT PULL: platform-drivers-x86 for v6.11-1](http://lore.kernel.org/lkml/pdx86-pr-20240716131410-2360330733@linux.intel.com/)**

**[GIT PULL: x86/sev for v6.11-rc1](http://lore.kernel.org/lkml/20240716095557.GAZpZDrdC3HA0Zilxr@fat_crate.local/)**

### 进程调度

**[v1: (repost): sched/core: defer printk() while rq lock is held](http://lore.kernel.org/lkml/94c1499a-2325-4bbf-b7bc-04a1e9090488@I-love.SAKURA.ne.jp/)**

> syzbot is reporting circular locking dependency inside __bpf_prog_run()
> when trace_sched_switch() hook is called from __schedule(), for fault
> injection calls printk() despite rq lock is already held.

**[v1: sched:add panic to remind that wake_q_node should be WAKE_Q_TAIL when emtpy](http://lore.kernel.org/lkml/20240717161901.2375-1-buckzhang1212@yeah.net/)**

> Here is a kernel exception ,wake_q_node is NULL.

**[[PATCH-RT sched v4 0/2] Optimize the RT group scheduling](http://lore.kernel.org/lkml/20240717030033.309205-1-xavier_qy@163.com/)**

> Fix compilation warnings in debug.c

**[v1: sched/fair: Sync se's load_avg with cfs_rq in reweight_entity](http://lore.kernel.org/lkml/20240716150840.23061-1-zhouchuyi@bytedance.com/)**

> In reweight_entity(), if !se->on_rq (e.g. when we are reweighting a
> sleeping task), we should sync the load_avg of se to cfs_rq before calling
> dequeue_load_avg(). Otherwise, the load_avg of this se can be inaccurate.

**[[PATCH-RT sched v3 0/2] Optimize the RT group scheduling](http://lore.kernel.org/lkml/20240716060514.304324-1-xavier_qy@163.com/)**

> Patch 3 fixed the issue with handling tasks with prio set to 0 during
> the execution of blktests.

**[[PATCH-RT sched v3 0/2] Optimize the RT group scheduling](http://lore.kernel.org/lkml/20240716052543.302383-1-xavier_qy@163.com/)**

> Patch 3 fixed the issue with handling tasks with prio set to 0 during
> the execution of blktests.

**[GIT PULL: sched/urgent for v6.10](http://lore.kernel.org/lkml/20240714093130.GAZpOa8kG3Aq6nfwQi@fat_crate.local/)**

### 内存管理

**[v1: HitShield:Something new eviction process for MGLRU](http://lore.kernel.org/linux-mm/20240720142528.276861-1-chminoo@g.cbnu.ac.kr/)**

> This hitshield technique was devised based on the observation that MGLRU
> does not consider the state of the folio when performing eviction.

**[v1: generic/736: don't run it on tmpfs](http://lore.kernel.org/linux-mm/20240720083538.2999155-1-yangerkun@huawei.com/)**

> We use offset_readdir for tmpfs, and every we call rename, the offset
> for the parent dir will increase by 1. So for tmpfs we will always
> fail since the infinite readdir.

**[v1: generic/732: don't run it on tmpfs](http://lore.kernel.org/linux-mm/20240720071323.2893437-1-yangerkun@huawei.com/)**

> Like what 4fd042e0465c("generic/732: don't run it on NFS") say, the same
> options for tmpfs won't share the same backend. Skip it for tmpfs.

**[v1: slab: Introduce kmalloc_obj() and family](http://lore.kernel.org/linux-mm/20240719192744.work.264-kees@kernel.org/)**

> Introduce type-aware kmalloc-family helpers to replace the common
> idioms for single, array, and flexible object allocations:

**[v1: mm-unstable: mm/hugetlb_vmemmap: don't synchronize_rcu() without HVO](http://lore.kernel.org/linux-mm/20240719042503.2752316-1-yuzhao@google.com/)**

> hugetlb_vmemmap_optimize_folio() and hugetlb_vmemmap_restore_folio()
> are wrappers meant to be called regardless of whether HVO is enabled.

**[v4: vmstat: Kernel stack usage histogram](http://lore.kernel.org/linux-mm/20240718202611.1695164-1-pasha.tatashin@soleen.com/)**

> As part of the dynamic kernel stack project, we need to know the amount
> of data that can be saved by reducing the default kernel stack size [1].

**[v3: binfmt_elf, coredump: Log the reason of the failed core dumps](http://lore.kernel.org/linux-mm/20240718182743.1959160-1-romank@linux.microsoft.com/)**

> A powerful way to diagnose crashes is to analyze the core dump produced upon
> the failure. Missing or malformed core dump files hinder these investigations.

**[v1: iomap: zero dirty folios over unwritten mappings on zero range](http://lore.kernel.org/linux-mm/20240718130212.23905-1-bfoster@redhat.com/)**

> This is a stab at fixing the iomap zero range problem where it doesn't
> correctly handle the case of an unwritten mapping with dirty pagecache.

**[v1: Align kvrealloc() with krealloc()](http://lore.kernel.org/linux-mm/20240717222427.2211-1-dakr@kernel.org/)**

> Besides the obvious (and desired) difference between krealloc() and kvrealloc(),
> there is some inconsistency in their function signatures and behavior

**[v9: EDAC: Scrub: Introduce generic EDAC RAS control feature driver + CXL/ACPI-RAS2 drivers](http://lore.kernel.org/linux-mm/20240716150336.2042-1-shiju.jose@huawei.com/)**

> Previously known as "ras: scrub: introduce subsystem + CXL/ACPI-RAS2 drivers".

**[v2: mTHP allocation stats for file-backed memory](http://lore.kernel.org/linux-mm/20240716135907.4047689-1-ryan.roberts@arm.com/)**

> With the mTHP shmem stat names cleaned up [2], we can now introduce real "file_"
> stats for file-backed memory.

**[v1: PATCHv2: mm: introduce reclaim throttle in MGLRU](http://lore.kernel.org/linux-mm/20240716094348.2451312-1-zhaoyang.huang@unisoc.com/)**

> This commit would like to have direct_reclaim be throttled by judging
> the numbers of isolated and inactive folios.

**[v2: mm/hwpoison: reset hwpoison filter parameters in pfn_inject_exit()](http://lore.kernel.org/linux-mm/20240716033516.606582-1-linmiaohe@huawei.com/)**

> When hwpoison_inject module is removed, hwpoison_filter_* parameters
> should be reset. Otherwise these parameters will have non-default values
> at next insmod time.

**[v1: Add GDB helper commands](http://lore.kernel.org/linux-mm/20240716031902.18200-1-kuan-ying.lee@canonical.com/)**

> I've created some useful GDB commands when I debug some
> memory issues.

**[v1: mm, memcg: cg2 memory{.swap,}.peak write handlers](http://lore.kernel.org/linux-mm/20240715203625.1462309-1-davidf@vimeo.com/)**

> This is a rebase of a patch I sent a few months ago, on which I received
> two acks, but the thread petered out

**[v6: fs: multigrain timestamp redux](http://lore.kernel.org/linux-mm/20240715-mgtime-v6-0-48e5d34bd2ba@kernel.org/)**

> It would
> be nice to have acks or reviews from maintainers for ext4 and tmpfs.

**[v1: mm: introduce reclaim throttle in MGLRU](http://lore.kernel.org/linux-mm/20240715101954.2433102-1-zhaoyang.huang@unisoc.com/)**

> Being like legacy LRU management, direct reclaim threads could isolate
> over-sized folios and then be rescheduled, which could lead to
> unwanted generation update as well as the thrashing things like before.

### 文件系统

**[v1: fanotify: don't skip extra event info if no info_mode is set](http://lore.kernel.org/linux-fsdevel/adfd31f369528c9958922d901fbe8eba48dfe496.1721403041.git.josef@toxicpanda.com/)**

> This isn't necessary as the event length is encoded in the
> metadata, and if the user doesn't want to consume the information they
> don't have to.

**[v1: cachefiles: Set the max subreq size for cache writes to MAX_RW_COUNT](http://lore.kernel.org/linux-fsdevel/1599005.1721398742@warthog.procyon.org.uk/)**

> Set the maximum size of a subrequest that writes to cachefiles to be
> MAX_RW_COUNT so that we don't overrun the maximum write we can make to the
> backing filesystem.

**[v4: vfs: correct the comments of vfs_*() helpers](http://lore.kernel.org/linux-fsdevel/tencent_2FCF6CC9E10DC8A27AE58A5A0FE4FCE96D0A@qq.com/)**

**[v1: vfs: handle __wait_on_freeing_inode() and evict() race](http://lore.kernel.org/linux-fsdevel/20240718151838.611807-1-mjguzik@gmail.com/)**

> Lockless hash lookup can find and lock the inode after it gets the
> I_FREEING flag set, at which point it blocks waiting for teardown in
> evict() to finish.

**[v5: fs/file.c: optimize the critical section of file_lock in](http://lore.kernel.org/linux-fsdevel/20240717145018.3972922-1-yu.ma@intel.com/)**

> pts/blogbench-1.1.0 is a benchmark designed to replicate the
> load of a real-world busy file server by multiple threads of
> random reads, writes, and rewrites.

**[v4: man2: Document RWF_ATOMIC](http://lore.kernel.org/linux-fsdevel/20240717093619.3148729-1-john.g.garry@oracle.com/)**

> Document RWF_ATOMIC flag for pwritev2().
> RWF_ATOMIC is used for enabling torn-write protection.
> We use RWF_ATOMIC as this is legacy name for similar feature proposed in
> the past.

**[GIT PULL: xfs: new code for 6.11](http://lore.kernel.org/linux-fsdevel/871q3sison.fsf@debian-BULLSEYE-live-builder-AMD64/)**

**[GIT PULL: sysctl changes for v6.11-rc1](http://lore.kernel.org/linux-fsdevel/20240716141656.pvlrrnxziok2jwxt@joelS2.panther.com/)**

**[v1: fs: buffer: set the expression type to unsigned long in folio_create_buffers()](http://lore.kernel.org/linux-fsdevel/20240716090105.72179-1-r.smirnov@omp.ru/)**

> Shift without specifying the type casts the expression to int,
> which is then passed as an unsigned long argument. It is necessary
> to use 1UL instead.

**[GIT PULL: zonefs changes for 6.11-rc1](http://lore.kernel.org/linux-fsdevel/20240715225306.43445-1-dlemoal@kernel.org/)**

**[v10: enable bs > ps in XFS](http://lore.kernel.org/linux-fsdevel/20240715094457.452836-1-kernel@pankajraghav.com/)**

> This is the tenth version of the series that enables block size > page size
> (Large Block Size) in XFS.

**[&#31572;&#22797;: v1: exfat: check disk status during buffer write](http://lore.kernel.org/linux-fsdevel/da2c0cd06c4a4dfa86f0ea2dbc3e1435@BJMBX02.spreadtrum.com/)**

> We found that when writing a large file through buffer write, if the
> disk is inaccessible, exFAT does not return an error normally, which
> leads to the writing process not stopping properly.
> To easily reproduce this issue, you can follow the steps below:

**[GIT PULL: bcachefs changes for 6.11](http://lore.kernel.org/linux-fsdevel/r75jqqdjp24gikil2l26wwtxdxvqxpgfaixb2rqmuyzxnbhseq@6k34emck64hv/)**

> This splits out the accounting of dirty sectors and stripe sectors in
> alloc keys; this lets us see stripe buckets that still have unstriped
> data in them.

**[v1: blk: optimization for classic polling](http://lore.kernel.org/linux-fsdevel/3578876466-3733-1-git-send-email-nj.shetty@samsung.com/)**

> This removes the dependency on interrupts to wake up task.

### 网络设备

**[GIT PULL: Networking for v6.11-rc0](http://lore.kernel.org/netdev/20240719161638.138354-1-pabeni@redhat.com/)**

> Small PR, mainly to unbreak the s390 build. We delayed it a little
> bit to try to catch a last-minute fix, but it will have to wait a
> bit more.

**[v2: bpf-next: Add BPF LSM return value range check, BPF part](http://lore.kernel.org/netdev/20240719110059.797546-1-xukuohai@huaweicloud.com/)**

> LSM BPF prog may make kernel panic when returning an unexpected value,
> such as returning positive value on hook file_alloc_security.

**[v1: Add Firmware Upload support for beagleplay cc1352](http://lore.kernel.org/netdev/20240719-beagleplay_fw_upgrade-v1-0-8664d4513252@beagleboard.org/)**

> Adds support for beagleplay cc1352 co-processor firmware upgrade using
> kernel Firmware Upload API. Uses ROM based bootloader present in
> cc13x2x7 and cc26x2x7 platforms for flashing over UART.

**[v2: ethtool:: add json support for base command](http://lore.kernel.org/netdev/20240719085544.2337393-1-f.pfitzner@pengutronix.de/)**

> Most subcommands already implement json support for their output. The
> base command (without supplying any subcommand) still lacks this
> option. This patch implments the needed changes to get json output,
> which is printed via "ethtool --json [iface]"

**[v1: -next: Add BPF LSM return value range check, BPF part](http://lore.kernel.org/netdev/20240719081749.769748-1-xukuohai@huaweicloud.com/)**

> LSM BPF prog may make kernel panic when returning an unexpected value,
> such as returning positive value on hook file_alloc_security.

**[v2: iwl-next: i40e: Add support for fw health report](http://lore.kernel.org/netdev/20240718181319.145884-1-kheib@redhat.com/)**

> Add support for reporting fw status via the devlink health report.

**[[RFT PATCH net] net: phy: aquantia: only poll GLOBAL_CFG registers on aqr113c and aqr115c](http://lore.kernel.org/netdev/20240718145747.131318-1-brgl@bgdev.pl/)**

> Commit 708405f3e56e ("net: phy: aquantia: wait for the GLOBAL_CFG to
> start returning real values") introduced a workaround for an issue
> observed on aqr115c.

**[v1: net: l2tp: make session IDR and tunnel session list coherent](http://lore.kernel.org/netdev/20240718134348.289865-1-jchapman@katalix.com/)**

> Modify l2tp_session_register and l2tp_session_unhash so that the
> session IDR and tunnel session lists remain coherent.

**[v3: net: igb: cope with large MAX_SKB_FRAGS.](http://lore.kernel.org/netdev/20240718085633.1285322-1-vinschen@redhat.com/)**

> Sabrina reports that the igb driver does not cope well with large
> MAX_SKB_FRAG values: setting MAX_SKB_FRAG to 45 causes payload
> corruption on TX.

**[v2: Add support for Amlogic HCI UART](http://lore.kernel.org/netdev/20240718-btaml-v2-0-1392b2e21183@amlogic.com/)**

> Add support for Amlogic HCI UART, including dt-binding,
> and Amlogic Bluetooth driver.

**[v7: Landlock: Abstract Unix Socket Scoping Support](http://lore.kernel.org/netdev/cover.1721269836.git.fahimitahera@gmail.com/)**

> This patch series adds scoping mechanism for abstract unix sockets.

**[v1: net-next: openvswitch: switch to per-action label counting in conntrack](http://lore.kernel.org/netdev/cb6cfbcbdd576ce4f3b74be080b939a9398d21c7.1721268615.git.lucien.xin@gmail.com/)**

> The difference is that nf_connlabels_get() is called unconditionally
> when creating an ct action in ovs_ct_copy_action().

**[linux-next: duplicate patch in the powerpc tree](http://lore.kernel.org/netdev/20240718095428.56145ce1@canb.auug.org.au/)**

> The following commit is also in the bpf tree as a different commit

**[v1: net: uapi: add TCPI_OPT_NODELAY to tcp_info](http://lore.kernel.org/netdev/20240717-nagle-tcpinfo-v1-1-83e149ef9953@gmail.com/)**

> Nagle's algorithm is one of the classic causes of poor performance for
> certain classes of userspace software over TCP, but is currently not
> reported in userspace tools such as ss(1) from iproute2 as it is only
> observable via getsockopt.

**[v1: net: dsa: microchip: ksz8795: add Wake on LAN support](http://lore.kernel.org/netdev/20240717193725.469192-1-vtpieter@gmail.com/)**

> Add WoL support for KSZ8795 family of switches. This code was tested
> with a KSZ8794 chip.

**[v2: net: eth: fbnic: don't build the driver when skb has more than 21 frags](http://lore.kernel.org/netdev/20240717161600.1291544-1-kuba@kernel.org/)**

> Similarly to commit 0e03c643dc93 ("eth: fbnic: fix s390 build."),
> the driver won't build if skb_shared_info has more than 25 frags
> assuming a 64B cache line and 21 frags assuming a 128B cache line.

**[v1: net: eth: fbnic: don't build the driver when skb has more than 25 frags](http://lore.kernel.org/netdev/20240717133744.1239356-1-kuba@kernel.org/)**

> Similarly to commit 0e03c643dc93 ("eth: fbnic: fix s390 build."),
> the driver won't build if skb_shared_info has more than 25 frags.

**[v3: net: linearizing skb when downgrade gso_size](http://lore.kernel.org/netdev/20240717053540.2438-1-dracodingfly@gmail.com/)**

> Linearizing skb when downgrade gso_size because it may
> trigger the BUG_ON when segment skb as described in [1].

**[v1: libnetlink: include endian.h for htobe64](http://lore.kernel.org/netdev/D2RI7Q8MEQEJ.3KAN74XCKVF8B@ayaya.dev/)**

> fixes build against musl libc which is more strict about header namespaces.

**[v1: net: tcp: process the 3rd ACK with sk_socket for for TFO/MPTCP](http://lore.kernel.org/netdev/20240716-upstream-net-next-20240716-tcp-3rd-ack-consume-sk_socket-v1-1-4e61d0b79233@kernel.org/)**

> The 'Fixes' commit recently changed the behaviour of TCP by skipping the
> processing of the 3rd ACK when a sk->sk_socket is set. The goal was to
> skip tcp_ack_snd_check() in tcp_rcv_state_process() not to send an
> unnecessary ACK in case of simultaneous connect(). Unfortunately, that
> had an impact on TFO and MPTCP.

**[v1: net: dsa: mv88e6xxx: Respect other ports when setting chip-wide MTU](http://lore.kernel.org/netdev/20240716120808.396514-1-martin@strongswan.org/)**

> DSA chips not supporting per-port jumbo frame size configurations use a
> chip-wide setting.

**[v2: net-next: Add support to PHYLINK for LAN743x/PCI11x1x chips](http://lore.kernel.org/netdev/20240716113349.25527-1-Raju.Lakkaraju@microchip.com/)**

> Divide the PHYLINK adaptation and SFP modifications into two separate patch
> series.

**[v3: iproute2-next: tc: f_flower: add support for matching on tunnel metadata](http://lore.kernel.org/netdev/cover.1721119088.git.dcaratti@redhat.com/)**

**[v1: net-next: virtio-net: support AF_XDP zero copy (tx)](http://lore.kernel.org/netdev/20240716064628.1950-1-xuanzhuo@linux.alibaba.com/)**

**[v1: net-next: lan78xx: Refactor interrupt handling and redundant messages](http://lore.kernel.org/netdev/20240716045818.1257906-1-rengarajan.s@microchip.com/)**

> The MAC and PHY interrupt are not synchronized.

### 安全增强

**[v2: loongarch: Support RANDOMIZE_KSTACK_OFFSET](http://lore.kernel.org/linux-hardening/20240719031427.119274-1-ruanjinjie@huawei.com/)**

> Add support of kernel stack offset randomization while handling syscall,
> the offset is defaultly limited by KSTACK_OFFSET_MAX().

**[v1: dmaengine: ti: omap-dma: Initialize sglen after allocation](http://lore.kernel.org/linux-hardening/20240716215702.work.802-kees@kernel.org/)**

> With the new __counted_by annocation, the "sglen" struct member must
> be set before accessing the "sg" array.

**[v1: interconnect: icc-clk: Add missed num_nodes initialization](http://lore.kernel.org/linux-hardening/20240716214819.work.328-kees@kernel.org/)**

> This initialization was done
> in other places where a new struct icc_onecell_data is allocated, but this
> case in icc_clk_register() was missed. Set "num_nodes" after allocation.

**[v1: leds: gpio: Set num_leds after allocation](http://lore.kernel.org/linux-hardening/20240716212455.work.809-kees@kernel.org/)**

> With the new __counted_by annotation, the "num_leds" variable needs to
> valid for accesses to the "leds" array.

### 异步 IO

**[v6: io_uring/rsrc: coalescing multi-hugepage registered buffers](http://lore.kernel.org/io-uring/20240716060807.2707-1-cliang01.li@samsung.com/)**

> Registered buffers are stored and processed in the form of bvec array,
> each bvec element typically points to a PAGE_SIZE page but can also work
> with hugepages.

**[v1: io_uring: Check socket is valid in io_bind()/io_listen()](http://lore.kernel.org/io-uring/903da529-eaa3-43ef-ae41-d30f376c60cc@I-love.SAKURA.ne.jp/)**

> We need to check that sock_from_file(req->file) != NULL.

### Rust For Linux

**[v1: rust: Support latest version of `rust-anayzer`](http://lore.kernel.org/rust-for-linux/20240719080709.1804899-1-ss269@uw.edu/)**

> Sets the `sysroot` field in rust-project.json which is now needed in
> newer versions of rust-anaylzer instead of the `sysroot_src` field.

**[v1: Introduce the Rust Safety Standard](http://lore.kernel.org/rust-for-linux/20240717221133.459589-1-benno.lossin@proton.me/)**

> `unsafe` Rust code in the kernel is required to have safety
> documentation. This is to ensure the correctness of `unsafe` code and is
> thus very important.

**[v4: drm/panic: Add a QR code panic screen](http://lore.kernel.org/rust-for-linux/20240717142644.1106060-1-jfalempe@redhat.com/)**

> This series adds a new panic screen, with the kmsg data embedded in a QR code.
> The main advantage of QR code, is that you can copy/paste the debug data to a bug report.

**[v1: Implement the smart pointer `InPlaceInit` for `Arc`](http://lore.kernel.org/rust-for-linux/20240717034801.262343-2-alexmantel93@mailbox.org/)**

> For pinned and unpinned initialization of structs, a trait named
> `InPlaceInit` exists for uniform access. `Arc` did not implement
> `InPlaceInit` yet, although the functions already existed. The main
> reason for that, was that the trait itself returned a `Pin<Self>`. The
> `Arc` implementation of the kernel is already implicitly pinned.

**[My first patch: Implement InPlaceInit for Arc](http://lore.kernel.org/rust-for-linux/20240717034801.262343-1-alexmantel93@mailbox.org/)**

> Lifted my arms up, placed my hands on my head, and tensed my non-existent abs.

### BPF

**[v1: bpf-next: use network helpers, part 10](http://lore.kernel.org/bpf/cover.1721475357.git.tanggeliang@kylinos.cn/)**

> This set is part 10 of series "use network helpers" all BPF selftests
> wide.


**[v1: bpf-next: bpf: Retire the unsupported_ops usage in struct_ops](http://lore.kernel.org/bpf/20240720062233.2319723-1-martin.lau@linux.dev/)**

> This series retires the unsupported_ops usage and depends on the
> null-ness check on the cfi_stubs instead.

**[v3: bpf-next: use network helpers, part 9](http://lore.kernel.org/bpf/cover.1721282219.git.tanggeliang@kylinos.cn/)**

**[v1: bpf-next: bpf/bpf_lru_list: make bpf_percpu_lru_pop_free safe in NMI](http://lore.kernel.org/bpf/CAPPBnEYO4R+m+SpVc2gNj_x31R6fo1uJvj2bK2YS1P09GWT6kQ@mail.gmail.com/)**

> This function is
> used by htab_percpu_lru_map_update_elem() which can be called from an
> NMI.

**[GIT PULL: ftrace: Rewrite of function graph to allow multiple users](http://lore.kernel.org/bpf/20240716162714.48febeaf@rorschach.local.home/)**

> Up until now, the function graph tracer could only have a single user
> attached to it.

**[v1: bpf-next: bpftool: add tcx subcommand in net](http://lore.kernel.org/bpf/20240715113704.1279881-1-chen.dylane@gmail.com/)**

> XDP prog has already realised with net attach/detach subcommand.
> As Qmonnet said [0], tcx prog may also can be added. So this patch set
> adds tcx subcommand in net attach/detach.

**[v1: bpf: Simplify character output in seq_print_delegate_opts()](http://lore.kernel.org/bpf/abde0992-3d71-44d2-ab27-75b382933a22@web.de/)**

> Single characters should be put into a sequence.
> Thus use the corresponding function &#8220;seq_putc&#8221; for two selected calls.

**[v9: bpf qdisc](http://lore.kernel.org/bpf/20240714175130.4051012-1-amery.hung@bytedance.com/)**

> This patchset aims to support implementing qdisc using bpf struct_ops.
> This version takes a step back and only implements the minimum support
> for bpf qdisc.

**[v1: bpf: Replace 8 seq_puts() calls by seq_putc() calls](http://lore.kernel.org/bpf/e26b7df9-cd63-491f-85e8-8cabe60a85e5@web.de/)**

> Single line breaks should occasionally be put into a sequence.
> This issue was transformed by using the Coccinelle software.

**[v4: powerpc: Core ftrace rework, support for ftrace direct and bpf trampolines](http://lore.kernel.org/bpf/cover.1720942106.git.naveen@kernel.org/)**

> This series reworks core ftrace support on powerpc to have the function
> profiling sequence moved out of line.

**[v1: perf/bpf: Don't call bpf_overflow_handler() for tracing events](http://lore.kernel.org/bpf/20240713044645.10840-1-khuey@kylehuey.com/)**

> The regressing commit is new in 6.10. It assumed that anytime event->prog
> is set bpf_overflow_handler() should be invoked to execute the attached bpf
> program.

## 周边技术动态

### Qemu

**[v6: target/riscv: Expose RV32 cpu to RV64 QEMU](http://lore.kernel.org/qemu-devel/20240719231149.1364-1-zhiwei_liu@linux.alibaba.com/)**

> This patch set aims to expose 32-bit RISC-V cpu to RV64 QEMU. Thus
> qemu-system-riscv64 can directly boot a RV32 Linux.

**[v2: target: riscv: Add Svvptc extension support](http://lore.kernel.org/qemu-devel/20240718160737.211285-1-alexghiti@rivosinc.com/)**

> The Svvptc extension describes a uarch that does not cache invalid TLB
> entries: that's the case for qemu so there is nothing particular to
> implement other than the introduction of this extension.

**[v1: riscv-to-apply queue](http://lore.kernel.org/qemu-devel/20240718021012.2057986-1-alistair.francis@wdc.com/)**

**[v5: Improve the performance of RISC-V vector unit-stride/whole register ld/st instructions](http://lore.kernel.org/qemu-devel/20240717133936.713642-1-max.chou@sifive.com/)**

> This version provides subroutine to iterate the load/store operations
> per page and replaces the original continuous load/store loop by the
> memcpy call.

**[v8: Support RISC-V IOPMP](http://lore.kernel.org/qemu-devel/20240715095702.1222213-1-ethan84@andestech.com/)**

> This series implements basic functions of IOPMP specification v0.9.1 rapid-k
> model.

### Buildroot

**[32-bit RISCV build error](http://lore.kernel.org/buildroot/YT2PR01MB4239F7AA538B4C2B46B13D7EF7A12@YT2PR01MB4239.CANPRD01.PROD.OUTLOOK.COM/)**

> I am resending this email as Buildroot Automated Email told me that I was not subscribed to the mailing list, and therefore, could not send to it. I double-checked, and I am a part of the mailing list, but this email technically has two aliases so I added the other one. Let's try this again. Sorry for the double message in case.

**[package/pkg-generic.mk: add variable to skip ccache dependency](http://lore.kernel.org/buildroot/20240713203105.0CB5786667@busybox.osuosl.org/)**

> As more and more packages are required to build the host ccache package
> and therefore they has to be filtered out for ccache dependency the list
> growed up.

**[package/gdb: add support for GDB 15.1](http://lore.kernel.org/buildroot/20240713155025.F39788655A@busybox.osuosl.org/)**

> Therefore, we make the option BR2_GDB_VERSION_15 depend on both
> BR2_HOST_GCC_AT_LEAST_9 *and* BR2_TOOLCHAIN_GCC_AT_LEAST_9.

### U-Boot

**[v3: Add Starfive JH7110 Cadence USB driver](http://lore.kernel.org/u-boot/20240719013822.101374-1-minda.chen@starfivetech.com/)**

> Add Starfive JH7110 Cadence USB driver and related PHY driver.
> So the codes can be used in visionfive2 and star64 7110 board.

**[v2: riscv: spacemit: bananapi_f3: add support for Banana Pi F3 board](http://lore.kernel.org/u-boot/20240718043329.1500-1-seashell11234455@gmail.com/)**

> This patch introduces fundamental support for the Banana Pi F3 board,
> encompassing UART, CPU, and PLIC support.

**[v2: Universal Payload initial series](http://lore.kernel.org/u-boot/20240713070055.2172883-1-sjg@chromium.org/)**

> Universal Payload (UPL) is an Industry Standard for firmware
> components.


